<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•ç®¡å…±å°„æ”¾å¤§ç”µè·¯è™šæ‹Ÿä»¿çœŸ (Dual Mode)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Environment Shim -->
    <script>
      window.process = { env: { NODE_ENV: 'production' } };
    </script>

    <!-- React Dependencies -->
    <script crossorigin src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Recharts -->
    <script crossorigin src="https://cdn.jsdelivr.net/npm/recharts@2.12.7/umd/Recharts.min.js"></script>
    
    <!-- Babel -->
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind Config -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              mono: ['JetBrains Mono', 'monospace'],
              serif: ['Roboto Serif', 'serif'],
            },
            colors: {
              scope: {
                bg: '#1a1b1e',
                grid: '#2c2e33',
              }
            }
          }
        }
      }
    </script>
    
    <style>
      body {
        background-color: #f8f9fa;
        color: #212529;
      }
      .friendly-range {
        -webkit-appearance: none; 
        background: transparent; 
      }
      .friendly-range::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 20px;
        width: 20px;
        border-radius: 50%;
        background: #3b82f6;
        cursor: pointer;
        margin-top: -8px; 
        box-shadow: 0 1px 3px rgba(0,0,0,0.3);
      }
      .friendly-range::-webkit-slider-runnable-track {
        width: 100%;
        height: 4px;
        cursor: pointer;
        background: #dee2e6;
        border-radius: 2px;
      }
      
      .std-range {
         -webkit-appearance: none;
         background: transparent;
      }
      .std-range::-webkit-slider-thumb {
         -webkit-appearance: none;
         background: #4b5563; 
         border: 1px solid #1f2937;
         width: 12px;
         height: 20px;
         margin-top: -8px;
         cursor: pointer;
      }
      .std-range::-webkit-slider-runnable-track {
         width: 100%;
         height: 4px;
         background: #d1d5db; 
         border-radius: 0;
      }
      /* Animation for collapse */
      .collapse-content {
          transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
          overflow: hidden;
      }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://aistudiocdn.com/react@^19.2.0",
        "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
        "react/": "https://aistudiocdn.com/react@^19.2.0/",
        "recharts": "https://aistudiocdn.com/recharts@^3.5.1"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        const Recharts = window.Recharts;
        
        if (!Recharts) {
            document.getElementById('root').innerHTML = '<div style="padding:20px; color:red;">Recharts load failed.</div>';
            throw new Error("Recharts not loaded");
        }

        const { LineChart, Line, XAxis, YAxis, CartesianGrid, ReferenceLine, ResponsiveContainer, Tooltip } = Recharts;

        // Constants
        const VCC = 12;
        const GND = 0;
        const MIN_BIAS = 0, MAX_BIAS = 12;
        const MIN_AMP = 0.01, MAX_AMP = 2.0;
        const MIN_GAIN = 1, MAX_GAIN = 10;
        const SAMPLE_POINTS = 100;
        const CYCLES = 2;

        const DistortionType = {
            None: 'NONE',
            Saturation: 'SATURATION',
            Cutoff: 'CUTOFF',
            Both: 'BOTH'
        };

        // Physics Logic
        const useSimulation = (state) => {
             return useMemo(() => {
                const newData = [];
                const points = SAMPLE_POINTS;
                let maxVoutRaw = -Infinity;
                let minVoutRaw = Infinity;

                for (let i = 0; i <= points; i++) {
                    const t = (i / points) * CYCLES * 2 * Math.PI;
                    const vin = state.amplitude * Math.sin(t);
                    const vout_raw = state.bias - (state.gain * vin);
                    const vout = Math.max(GND, Math.min(VCC, vout_raw));
                    maxVoutRaw = Math.max(maxVoutRaw, vout_raw);
                    minVoutRaw = Math.min(minVoutRaw, vout_raw);
                    newData.push({ time: i, vin: vin, vout, vout_raw });
                }

                let status;
                const isTopClipped = maxVoutRaw > VCC + 0.05; 
                const isBottomClipped = minVoutRaw < GND - 0.05;

                if (isTopClipped && isBottomClipped) {
                    status = { type: DistortionType.Both, message: "âš ï¸ åŒå‘å¤±çœŸ", longMessage: "âš ï¸ åŒå‘å¤±çœŸï¼ä¿¡å·è¿‡å¤§ã€‚", color: "border-red-500 text-red-700 bg-red-50", stdColor: "text-red-600 bg-red-50 border-red-200" };
                } else if (isTopClipped) {
                    status = { type: DistortionType.Cutoff, message: "âš ï¸ æˆªæ­¢å¤±çœŸ", longMessage: "âš ï¸ æˆªæ­¢å¤±çœŸï¼Qç‚¹è¿‡é«˜ã€‚", color: "border-orange-500 text-orange-700 bg-orange-50", stdColor: "text-orange-600 bg-orange-50 border-orange-200" };
                } else if (isBottomClipped) {
                    status = { type: DistortionType.Saturation, message: "âš ï¸ é¥±å’Œå¤±çœŸ", longMessage: "âš ï¸ é¥±å’Œå¤±çœŸï¼Qç‚¹è¿‡ä½ã€‚", color: "border-orange-500 text-orange-700 bg-orange-50", stdColor: "text-orange-600 bg-orange-50 border-orange-200" };
                } else {
                    status = { type: DistortionType.None, message: "âœ… çº¿æ€§æ”¾å¤§åŒº", longMessage: "âœ… çŠ¶æ€è‰¯å¥½ï¼šçº¿æ€§æ”¾å¤§åŒºã€‚", color: "border-green-500 text-green-700 bg-green-50", stdColor: "text-green-700 bg-green-50 border-green-200" };
                }
                return { data: newData, diagnostic: status };
            }, [state]);
        }

        // --- Component: Real Lab Scene Image (Aligned) ---
        const RealLabScene = () => {
            const [isOpen, setIsOpen] = useState(false); 

            return (
                <div className="max-w-7xl mx-auto px-4 md:px-6 lg:px-8 mt-6 w-full">
                    <div className="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden">
                        <button 
                            onClick={() => setIsOpen(!isOpen)}
                            className="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 transition-colors text-left"
                        >
                            <div className="flex items-center gap-3">
                                <span className="text-xl">ğŸ“¸</span>
                                <span className="font-bold text-gray-700">æœ¬ç³»ç»Ÿæ¨¡æ‹Ÿçš„å®éªŒçœŸå®æ“ä½œåœºæ™¯</span>
                                <span className="text-xs text-gray-400 font-mono bg-gray-200 px-2 py-0.5 rounded">
                                    {isOpen ? 'æ”¶èµ·' : 'å±•å¼€æŸ¥çœ‹'}
                                </span>
                            </div>
                            <svg className={`w-5 h-5 text-gray-500 transform transition-transform duration-300 ${isOpen ? 'rotate-180' : ''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>
                        </button>

                        <div className={`collapse-content bg-black flex justify-center items-center ${isOpen ? 'max-h-[800px] opacity-100' : 'max-h-0 opacity-0'}`}>
                            <img src="./lab_scene.jpg" alt="å®éªŒå®¤çœŸå®æ“ä½œåœºæ™¯" className="max-w-full h-auto object-contain max-h-[600px]" onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.innerHTML = '<div class="p-8 text-gray-400 text-center">âŒ å›¾ç‰‡åŠ è½½å¤±è´¥<br/><span class="text-sm">è¯·ç¡®è®¤å›¾ç‰‡æ–‡ä»¶åä¸º <b>lab_scene.jpg</b> ä¸”ä¸htmlåœ¨åŒä¸€ç›®å½•</span></div>'; }}/>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Component: Principle Animation ---
        const PrincipleAnimation = () => {
            const [time, setTime] = useState(0);
            
            useEffect(() => {
                let animationFrameId;
                const animate = () => {
                    setTime(t => t + 0.01); // Slowed down from 0.05 to 0.01 for better visibility
                    animationFrameId = requestAnimationFrame(animate);
                };
                animate();
                return () => cancelAnimationFrame(animationFrameId);
            }, []);

            // Generate wave path
            const generateWavePath = (xOffset, yOffset, width, amp, phase) => {
                const points = [];
                const freq = 0.05; 
                const speed = 3; // Slowed down multiplier from 5 to 3
                
                for (let x = 0; x <= width; x += 5) {
                    const angle = (x * freq) + (time * speed) + phase;
                    const y = yOffset + Math.sin(angle) * amp;
                    points.push(`${x + xOffset},${y}`);
                }
                return `M ${points[0]} L ${points.slice(1).join(' ')}`;
            };

            // Dynamic logic for the "Valve" visual
            const currentSignal = Math.sin(time * 3); // Slowed down frequency multiplier from 5 to 3

            return (
                <div className="bg-slate-900 rounded-xl p-4 md:p-6 mb-6 shadow-inner border border-slate-700 text-slate-100 overflow-hidden">
                    <div className="flex justify-between items-center mb-6 border-b border-slate-700 pb-2">
                        <h4 className="font-bold text-lg flex items-center gap-2 text-yellow-400">
                            <span className="text-2xl">ğŸ¬</span> åŸç†ç§‘æ™®åŠ¨ç”»ï¼šä¿¡å·æ”¾å¤§çš„ç§˜å¯†
                        </h4>
                        <div className="text-xs bg-slate-800 px-3 py-1 rounded-full border border-slate-600 text-gray-300">
                           æ ¸å¿ƒæœºåˆ¶ï¼šå°ç”µæµæ§åˆ¶å¤§ç”µæµ
                        </div>
                    </div>

                    <div className="relative w-full h-[240px] select-none">
                        <svg className="w-full h-full" viewBox="0 0 800 240" preserveAspectRatio="xMidYMid meet">
                            <defs>
                                <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                                    <feGaussianBlur stdDeviation="2" result="blur" />
                                    <feComposite in="SourceGraphic" in2="blur" operator="over" />
                                </filter>
                                <marker id="arrow-head" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#6b7280" />
                                </marker>
                            </defs>

                            {/* 1. INPUT STAGE (Left) */}
                            <g transform="translate(50, 120)">
                                <text x="50" y="-50" fill="#fcd34d" fontSize="14" fontWeight="bold" textAnchor="middle">è¾“å…¥ä¿¡å· (Vin)</text>
                                <text x="50" y="-35" fill="#9ca3af" fontSize="10" textAnchor="middle">å¾®å¼±æ³¢åŠ¨</text>
                                <line x1="0" y1="0" x2="100" y2="0" stroke="#4b5563" strokeWidth="2" />
                                <path d={generateWavePath(0, 0, 100, 10, 0)} stroke="#fcd34d" strokeWidth="3" fill="none" />
                            </g>

                            {/* 2. TRANSISTOR STAGE (Center) */}
                            <g transform="translate(250, 120)">
                                <line x1="0" y1="-80" x2="0" y2="-20" stroke="#ef4444" strokeWidth="4" opacity="0.5" /> {/* VCC Line */}
                                <line x1="0" y1="20" x2="0" y2="80" stroke="#3b82f6" strokeWidth="4" opacity="0.5" /> {/* GND Line */}
                                
                                {/* Transistor Symbol */}
                                <circle cx="0" cy="0" r="30" fill="#1f2937" stroke="#6b7280" strokeWidth="2" />
                                
                                {/* Base connection */}
                                <line x1="-100" y1="0" x2="-30" y2="0" stroke="#fcd34d" strokeWidth="2" strokeDasharray="4 2" />

                                {/* Dynamic Current Flow (Collector to Emitter) - The "Valve" effect */}
                                <line x1="0" y1="-30" x2="0" y2="30" stroke="#fff" strokeWidth={Math.max(1, 10 + currentSignal * 8)} strokeLinecap="round" style={{transition: 'stroke-width 0.1s'}} />
                                
                                <text x="0" y="-90" fill="#ef4444" fontSize="12" fontWeight="bold" textAnchor="middle">VCC (12V)</text>
                                <text x="0" y="100" fill="#3b82f6" fontSize="12" fontWeight="bold" textAnchor="middle">GND (0V)</text>
                                <text x="0" y="5" fill="#fff" fontSize="10" textAnchor="middle" pointerEvents="none" style={{mixBlendMode: 'difference'}}>ä¸‰æç®¡ (é˜€é—¨)</text>
                            </g>

                            {/* 3. OUTPUT STAGE (Right) */}
                            <g transform="translate(350, 120)">
                                <text x="150" y="-50" fill="#4ade80" fontSize="14" fontWeight="bold" textAnchor="middle">è¾“å‡ºä¿¡å· (Vout)</text>
                                <text x="150" y="-35" fill="#9ca3af" fontSize="10" textAnchor="middle">å¤§å¹…åº¦åç›¸æ³¢åŠ¨</text>
                                
                                <line x1="-100" y1="-40" x2="0" y2="-40" stroke="#4b5563" strokeWidth="2" strokeDasharray="4 4" />
                                <circle cx="-100" cy="-40" r="4" fill="#ef4444" /> {/* Collector Node */}

                                {/* Output Wave - Green, Inverted, Larger */}
                                <path d={generateWavePath(0, 0, 300, 40, Math.PI)} stroke="#4ade80" strokeWidth="4" fill="none" filter="url(#glow)" />
                            </g>

                             {/* Logic Arrows */}
                            <g opacity="0.7">
                                <path d="M 160 110 L 190 110" stroke="#fcd34d" strokeWidth="2" markerEnd="url(#arrow-head)" />
                                <text x="175" y="105" fill="#fcd34d" fontSize="10" textAnchor="middle">æ§åˆ¶</text>
                            </g>
                        </svg>
                        
                        {/* Status Legend */}
                        <div className="absolute bottom-2 right-4 text-right pointer-events-none">
                             <div className="text-xl md:text-2xl font-mono font-bold text-white transition-all duration-100" style={{opacity: 0.9, textShadow: '0 2px 4px rgba(0,0,0,0.5)'}}>
                                {currentSignal > 0.5 ? "ğŸŒŠ é˜€é—¨å¤§å¼€ (å¤§ç”µæµ)" : currentSignal < -0.5 ? "ğŸ›‘ é˜€é—¨å…³å° (å°ç”µæµ)" : "âš–ï¸ å¹³è¡¡çŠ¶æ€ (é™æ€)"}
                             </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Component: Experiment Principle (Aligned) ---
        const ExperimentPrinciple = () => {
            const [isOpen, setIsOpen] = useState(false); 

            return (
                <div className="max-w-7xl mx-auto px-4 md:px-6 lg:px-8 mt-4 w-full">
                    <div className="bg-white border border-blue-100 rounded-xl shadow-sm overflow-hidden">
                        <button 
                            onClick={() => setIsOpen(!isOpen)}
                            className="w-full flex items-center justify-between p-4 bg-blue-50 hover:bg-blue-100 transition-colors text-left"
                        >
                            <div className="flex items-center gap-3">
                                <span className="text-xl">ğŸ“–</span>
                                <span className="font-bold text-blue-900">æœ¬ç³»ç»Ÿæ¨¡æ‹Ÿå®éªŒçš„åŸç†</span>
                                <span className="text-xs text-blue-500 font-mono bg-blue-200 px-2 py-0.5 rounded">
                                    {isOpen ? 'æ”¶èµ·' : 'å±•å¼€å­¦ä¹ '}
                                </span>
                            </div>
                            <svg className={`w-5 h-5 text-blue-500 transform transition-transform duration-300 ${isOpen ? 'rotate-180' : ''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>
                        </button>

                        <div className={`collapse-content bg-white px-6 py-2 ${isOpen ? 'max-h-[2000px] opacity-100' : 'max-h-0 opacity-0'}`}>
                            <div className="prose max-w-none py-4 text-slate-700">
                                {/* Animation Component Inserted Here */}
                                <PrincipleAnimation />

                                <div className="mb-6 p-4 bg-yellow-50 rounded-lg border border-yellow-100 text-sm">
                                    <p className="font-bold text-yellow-800">ğŸ’¡ æ ¸å¿ƒåŸç†æ€»ç»“</p>
                                    <p className="mt-1">è¿™ä¸ªç”µè·¯æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<b>ä¸²è”åˆ†å‹ç”µè·¯</b>ã€‚ä¸‰æç®¡åœ¨ç”µè·¯ä¸­ç›¸å½“äºä¸€ä¸ªé˜»å€¼ä¼šéšä¿¡å·å˜åŒ–çš„â€œå¯å˜ç”µé˜»â€ã€‚</p>
                                </div>

                                <div className="grid md:grid-cols-2 gap-8">
                                    <div>
                                        <h4 className="font-bold text-gray-900 text-lg mb-3">1. ä¸‰ä¸ªæ»‘å—ä»£è¡¨ä»€ä¹ˆï¼Ÿ</h4>
                                        <ul className="space-y-4">
                                            <li className="flex gap-3">
                                                <div className="w-8 h-8 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center font-bold text-sm shrink-0">Bias</div>
                                                <div>
                                                    <span className="font-bold text-gray-900">åç½®ç”µå‹ (é™æ€ä½ç½®)</span>
                                                    <p className="text-sm text-gray-600">è¿™æ˜¯æ³¢å½¢çš„â€œå¹³è¡¡ä½ç½®â€ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä¸ºäº†è®©ä½ åœ¨æˆ¿é—´é‡Œä¸Šä¸‹è·³è·ƒä¸æ’å¤´ä¹Ÿä¸æ’åœ°ï¼Œæœ€å¥½çš„èµ·å§‹ä½ç½®æ˜¯ç«™åœ¨æˆ¿é—´çš„æ­£ä¸­é—´ (6V)ã€‚</p>
                                                </div>
                                            </li>
                                            <li className="flex gap-3">
                                                <div className="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-sm shrink-0">Vin</div>
                                                <div>
                                                    <span className="font-bold text-gray-900">è¾“å…¥å¹…åº¦ (è·³è·ƒé«˜åº¦)</span>
                                                    <p className="text-sm text-gray-600">è¿™æ˜¯ä½ çš„éº¦å…‹é£ä¿¡å·ã€‚ä¿¡å·è¶Šå¤§ï¼Œæ³¢å½¢ä¸Šä¸‹æ‘†åŠ¨çš„èŒƒå›´å°±è¶Šå¤§ã€‚</p>
                                                </div>
                                            </li>
                                            <li className="flex gap-3">
                                                <div className="w-8 h-8 rounded-full bg-green-100 text-green-600 flex items-center justify-center font-bold text-sm shrink-0">Av</div>
                                                <div>
                                                    <span className="font-bold text-gray-900">ç”µå‹å¢ç›Š (æ”¾å¤§å€æ•°)</span>
                                                    <p className="text-sm text-gray-600">è¿™æ˜¯ç³»ç»Ÿçš„çµæ•åº¦ã€‚å¢ç›Šè¶Šå¤§ï¼Œè¾“å…¥ä¿¡å·å¾®å°çš„å˜åŒ–å°±ä¼šå¼•èµ·è¾“å‡ºç«¯å·¨å¤§çš„æ³¢åŠ¨ã€‚</p>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>

                                    <div>
                                        <h4 className="font-bold text-gray-900 text-lg mb-3">2. ä¸ºä»€ä¹ˆä¼šâ€œå‰Šå¹³â€ (å¤±çœŸ)ï¼Ÿ</h4>
                                        <div className="bg-slate-100 p-4 rounded-lg font-mono text-sm mb-4">
                                            <div className="mb-2">å…¬å¼ï¼š<span className="text-green-600 font-bold">è¾“å‡º</span> = <span className="text-purple-600 font-bold">åç½®</span> Â± (<span className="text-blue-600 font-bold">è¾“å…¥</span> Ã— <span className="text-gray-600 font-bold">å¢ç›Š</span>)</div>
                                            <div className="text-xs text-gray-500">*å¿½ç•¥åç›¸è´Ÿå·ï¼Œåªçœ‹å¹…åº¦</div>
                                        </div>
                                        <p className="text-sm text-gray-600 mb-2">æ— è®ºä½ æ€ä¹ˆç®—ï¼Œç”µè·¯çš„è¾“å‡ºæ°¸è¿œå—é™äºç”µæºç”µå‹ï¼š</p>
                                        <ul className="list-disc pl-5 space-y-2 text-sm text-gray-700">
                                            <li><span className="font-bold text-red-500">å¤©èŠ±æ¿ (12V)</span>ï¼šå¦‚æœç®—å‡ºæ¥çš„ç”µå‹è¶…è¿‡12Vï¼Œæ³¢å½¢é¡¶éƒ¨ä¼šè¢«å¼ºè¡Œåˆ‡å¹³ï¼ˆ<b>æˆªæ­¢å¤±çœŸ</b>ï¼‰ã€‚</li>
                                            <li><span className="font-bold text-red-500">åœ°æ¿ (0V)</span>ï¼šå¦‚æœç®—å‡ºæ¥çš„ç”µå‹ä½äº0Vï¼Œæ³¢å½¢åº•éƒ¨ä¼šè¢«å¼ºè¡Œåˆ‡å¹³ï¼ˆ<b>é¥±å’Œå¤±çœŸ</b>ï¼‰ã€‚</li>
                                        </ul>
                                        <div className="mt-4 p-3 border-l-4 border-green-500 bg-green-50 text-xs text-green-800">
                                            <b>ç»“è®ºï¼š</b>ä¸ºäº†ä¸å¤±çœŸï¼Œå¿…é¡»æŠŠåç½®è°ƒåœ¨ä¸­é—´ (6V)ï¼Œä¸”å¢ç›Šå’Œè¾“å…¥ä¸èƒ½å¤ªå¤§ï¼Œé˜²æ­¢æ’åˆ°å¤©èŠ±æ¿æˆ–åœ°æ¿ã€‚
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ... Existing Components ...
        const GuidePanel = () => (
            <div className="bg-slate-800 text-slate-200 p-6 rounded-xl shadow-lg h-full">
                <h3 className="text-xl font-bold text-white mb-6 border-b border-slate-600 pb-2">ğŸ§ª å®éªŒæ“ä½œæŒ‡å—</h3>
                <div className="space-y-6">
                    <div className="relative pl-6 border-l-2 border-blue-500">
                        <div className="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-blue-500"></div>
                        <h4 className="font-bold text-white">ç¬¬ 1 æ­¥ï¼šè®¾ç½®è¾“å…¥</h4>
                        <p className="text-sm text-slate-400 mt-1">è°ƒèŠ‚ <span className="text-blue-300 font-mono">è¾“å…¥ä¿¡å·å¹…åº¦</span>ã€‚</p>
                    </div>
                    <div className="relative pl-6 border-l-2 border-purple-500">
                        <div className="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-purple-500"></div>
                        <h4 className="font-bold text-white">ç¬¬ 2 æ­¥ï¼šè°ƒèŠ‚ Q ç‚¹</h4>
                        <p className="text-sm text-slate-400 mt-1">è°ƒèŠ‚ <span className="text-purple-300 font-mono">é™æ€å·¥ä½œç‚¹ (Bias)</span>ã€‚</p>
                    </div>
                    <div className="relative pl-6 border-l-2 border-green-500">
                        <div className="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-green-500"></div>
                        <h4 className="font-bold text-white">ç¬¬ 3 æ­¥ï¼šè§‚å¯Ÿå¤±çœŸ</h4>
                        <p className="text-sm text-slate-400 mt-1">è§‚å¯Ÿæ³¢å½¢å‰Šé¡¶æˆ–å‰Šåº•ç°è±¡ã€‚</p>
                    </div>
                </div>
            </div>
        );

        const DiagnosticPanel = ({ status }) => {
            const getIcon = () => (status.type === DistortionType.None ? "âœ…" : "âš ï¸");
            return (
                <div className={`flex items-center gap-3 p-4 rounded-lg border-l-4 shadow-sm transition-colors duration-300 ${status.color}`}>
                    <div className="text-2xl">{getIcon()}</div>
                    <div>
                        <h4 className="font-bold text-lg">ç³»ç»ŸçŠ¶æ€è¯Šæ–­</h4>
                        <p className="text-sm font-medium">{status.longMessage}</p>
                    </div>
                </div>
            );
        };

        const FriendlyOscilloscope = ({ data }) => (
            <div className="w-full h-[300px] md:h-[400px] bg-scope-bg rounded-lg shadow-inner border-4 border-gray-700 relative overflow-hidden">
                <div className="absolute inset-0 bg-gradient-to-br from-white/5 to-transparent pointer-events-none z-10 rounded-lg"></div>
                <ResponsiveContainer width="100%" height="100%">
                    <LineChart data={data} margin={{ top: 20, right: 30, left: 0, bottom: 20 }}>
                        <CartesianGrid stroke="#2c2e33" strokeDasharray="3 3" vertical={false} />
                        <XAxis dataKey="time" type="number" hide domain={['dataMin', 'dataMax']} />
                        <YAxis domain={[-2, 14]} tickCount={8} stroke="#868e96" tick={{ fontSize: 12, fill: '#868e96' }} width={40} />
                        <Tooltip contentStyle={{ backgroundColor: '#1a1b1e', borderColor: '#495057', color: '#f8f9fa' }} itemStyle={{ fontSize: '12px' }} labelStyle={{ display: 'none' }} formatter={(value) => value.toFixed(2) + ' V'} />
                        <ReferenceLine y={VCC} stroke="#ef4444" strokeDasharray="4 4" label={{ value: 'Vcc (12V)', fill: '#ef4444', fontSize: 12, position: 'insideTopRight' }} />
                        <ReferenceLine y={GND} stroke="#ef4444" strokeDasharray="4 4" label={{ value: 'GND (0V)', fill: '#ef4444', fontSize: 12, position: 'insideBottomRight' }} />
                        <Line type="monotone" dataKey="vin" stroke="#ffd43b" strokeWidth={2} dot={false} name="è¾“å…¥ (Vin)" isAnimationActive={false} />
                        <Line type="monotone" dataKey="vout" stroke="#51cf66" strokeWidth={3} dot={false} name="è¾“å‡º (Vout)" isAnimationActive={false} />
                    </LineChart>
                </ResponsiveContainer>
            </div>
        );

        const FriendlyControl = ({ values, onChange }) => (
            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">ğŸ•¹ï¸ ç”µè·¯å‚æ•°æ§åˆ¶</h3>
                <div className="space-y-6">
                    <div>
                        <div className="flex justify-between mb-1"><label className="text-sm font-medium text-gray-700">1. è¾“å…¥ä¿¡å·å¹…åº¦ (Vin)</label><span className="text-sm font-mono text-blue-600 bg-blue-50 px-2 rounded">{values.amplitude.toFixed(2)} V</span></div>
                        <input type="range" min={MIN_AMP} max={MAX_AMP} step={0.1} value={values.amplitude} onChange={(e) => onChange('amplitude', parseFloat(e.target.value))} className="friendly-range w-full" />
                    </div>
                    <div>
                        <div className="flex justify-between mb-1"><label className="text-sm font-medium text-gray-700">2. é™æ€å·¥ä½œç‚¹ (Bias)</label><span className="text-sm font-mono text-purple-600 bg-purple-50 px-2 rounded">{values.bias.toFixed(1)} V</span></div>
                        <input type="range" min={MIN_BIAS} max={MAX_BIAS} step={0.1} value={values.bias} onChange={(e) => onChange('bias', parseFloat(e.target.value))} className="friendly-range w-full" />
                    </div>
                    <div>
                        <div className="flex justify-between mb-1"><label className="text-sm font-medium text-gray-700">3. ç”µå‹å¢ç›Š (Gain)</label><span className="text-sm font-mono text-green-600 bg-green-50 px-2 rounded">{values.gain.toFixed(1)}x</span></div>
                        <input type="range" min={MIN_GAIN} max={MAX_GAIN} step={0.1} value={values.gain} onChange={(e) => onChange('gain', parseFloat(e.target.value))} className="friendly-range w-full" />
                    </div>
                </div>
            </div>
        );

        const StandardControlItem = ({ label, value, min, max, step, onChange, unit }) => (
            <div className="flex flex-col gap-1 mb-4">
                <div className="flex justify-between text-xs font-bold text-gray-600 uppercase">
                    <label>{label}</label>
                    <span className="font-mono">{value.toFixed(2)}{unit}</span>
                </div>
                <input type="range" min={min} max={max} step={step} value={value} onChange={onChange} className="std-range h-4 w-full" />
            </div>
        );

        const StandardView = ({ state, data, diagnostic, onControlChange }) => {
            return (
                <div className="max-w-6xl mx-auto bg-white border border-gray-400 shadow-xl p-8 font-serif text-gray-900">
                    <div className="border-b-2 border-black pb-4 mb-6 flex flex-col md:flex-row justify-between items-end gap-4">
                        <div>
                            <h2 className="text-2xl font-bold uppercase tracking-widest text-black">å•ç®¡å…±å°„æ”¾å¤§ç”µè·¯</h2>
                            <p className="text-xs font-mono text-gray-500 mt-1">è™šæ‹Ÿä»¿çœŸå®éªŒå®¤: EIE-LAB-2024</p>
                        </div>
                        <div className="text-right">
                             <div className={`text-sm font-bold font-mono border px-3 py-1 ${diagnostic.stdColor}`}>
                                çŠ¶æ€: {diagnostic.message}
                             </div>
                        </div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-12 gap-8">
                        <div className="md:col-span-8 space-y-8">
                            <div className="border border-gray-300 p-4 relative">
                                <h4 className="absolute top-0 left-0 bg-gray-100 text-xs font-bold px-2 py-1 border-r border-b border-gray-300">å›¾ 1. è¾“å…¥ä¿¡å· $v_i(t)$</h4>
                                <div className="h-[200px] mt-4">
                                    <ResponsiveContainer>
                                        <LineChart data={data}>
                                            <CartesianGrid strokeDasharray="3 3" stroke="#e5e7eb" />
                                            <XAxis dataKey="time" hide />
                                            <YAxis label={{ value: 'ç”µå‹ (V)', angle: -90, position: 'insideLeft', style: {fontSize: 10} }} domain={[-2.5, 2.5]} tick={{fontSize: 10}} width={40} />
                                            <Tooltip contentStyle={{ fontSize: '12px', border: '1px solid #ccc' }} formatter={(val) => val.toFixed(3) + ' V'} labelStyle={{display:'none'}} />
                                            <ReferenceLine y={0} stroke="#9ca3af" />
                                            <Line type="monotone" dataKey="vin" stroke="#d97706" dot={false} strokeWidth={2} isAnimationActive={false} name="è¾“å…¥ Vin" />
                                        </LineChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                            <div className="border border-gray-300 p-4 relative">
                                <h4 className="absolute top-0 left-0 bg-gray-100 text-xs font-bold px-2 py-1 border-r border-b border-gray-300">å›¾ 2. è¾“å‡ºä¿¡å· $v_o(t)$</h4>
                                <div className="h-[250px] mt-4">
                                    <ResponsiveContainer>
                                        <LineChart data={data}>
                                            <CartesianGrid strokeDasharray="3 3" stroke="#e5e7eb" />
                                            <XAxis dataKey="time" hide />
                                            <YAxis label={{ value: 'ç”µå‹ (V)', angle: -90, position: 'insideLeft', style: {fontSize: 10} }} domain={[-1, 13]} ticks={[0, 3, 6, 9, 12]} tick={{fontSize: 10}} width={40} />
                                            <Tooltip contentStyle={{ fontSize: '12px', border: '1px solid #ccc' }} formatter={(val) => val.toFixed(2) + ' V'} labelStyle={{display:'none'}} />
                                            <ReferenceLine y={12} stroke="red" strokeDasharray="5 5" label={{ value: 'Vcc (12V)', fontSize: 10, fill: 'red', position: 'insideTopRight' }} />
                                            <ReferenceLine y={0} stroke="red" strokeDasharray="5 5" label={{ value: 'GND (0V)', fontSize: 10, fill: 'red', position: 'insideBottomRight' }} />
                                            <ReferenceLine y={state.bias} stroke="blue" strokeDasharray="2 2" label={{ value: 'Qç‚¹', fontSize: 10, fill: 'blue', position: 'insideLeft' }} />
                                            <Line type="monotone" dataKey="vout" stroke="#16a34a" dot={false} strokeWidth={2} isAnimationActive={false} name="è¾“å‡º Vout" />
                                            {(diagnostic.type !== DistortionType.None) && (
                                                <Line type="monotone" dataKey="vout_raw" stroke="#ff0000" strokeOpacity={0.2} dot={false} strokeDasharray="3 3" strokeWidth={1} isAnimationActive={false} name="ç†æƒ³æ³¢å½¢" />
                                            )}
                                        </LineChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        </div>
                        <div className="md:col-span-4 bg-gray-50 p-6 border border-gray-300">
                            <h3 className="font-bold border-b border-gray-300 pb-2 mb-6 text-sm uppercase">ç”µè·¯å‚æ•°è®¾ç½®</h3>
                            <StandardControlItem label="åç½®ç”µå‹ (V_bias)" value={state.bias} min={MIN_BIAS} max={MAX_BIAS} step={0.1} onChange={(e) => onControlChange('bias', parseFloat(e.target.value))} unit=" V"/>
                            <StandardControlItem label="è¾“å…¥ä¿¡å·å¹…åº¦ (V_in)" value={state.amplitude} min={MIN_AMP} max={MAX_AMP} step={0.05} onChange={(e) => onControlChange('amplitude', parseFloat(e.target.value))} unit=" V"/>
                            <StandardControlItem label="ç”µå‹å¢ç›Š (Av)" value={state.gain} min={MIN_GAIN} max={MAX_GAIN} step={0.1} onChange={(e) => onControlChange('gain', parseFloat(e.target.value))} unit=" x"/>
                            <div className="mt-8 pt-4 border-t border-gray-300 text-xs text-gray-500 font-mono space-y-2">
                                <p><strong>ç”µè·¯è§„æ ¼å‚æ•°:</strong></p>
                                <p>ç±»å‹: å…±å°„ææ”¾å¤§ç”µè·¯ (NPN)</p>
                                <p>ç”µæº Vcc: 12.0V</p>
                                <p>ç›¸ä½å·®: 180Â° (åç›¸)</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const FriendlyView = ({ state, data, diagnostic, onControlChange }) => {
            return (
                <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 h-full">
                    <div className="lg:col-span-3 order-3 lg:order-1"><GuidePanel /></div>
                    <div className="lg:col-span-9 order-1 lg:order-2 flex flex-col gap-6">
                        <DiagnosticPanel status={diagnostic} />
                        <div className="relative">
                            <div className="absolute -top-3 left-4 bg-gray-800 text-white text-xs px-2 py-1 rounded shadow-sm z-10 font-mono">ç¤ºæ³¢å™¨ OSCILLOSCOPE</div>
                            <FriendlyOscilloscope data={data} />
                        </div>
                        <div className="mt-2"><FriendlyControl values={state} onChange={onControlChange} /></div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [mode, setMode] = useState('friendly');
            const [state, setState] = useState({ bias: 10, amplitude: 1.0, gain: 3.0 });
            const handleControlChange = (key, value) => { setState(prev => ({ ...prev, [key]: value })); };
            const { data, diagnostic } = useSimulation(state);

            return (
                <div className="min-h-screen bg-gray-50 flex flex-col font-sans">
                    <header className="bg-white border-b border-gray-200 px-6 py-4 shadow-sm z-50">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row md:items-center justify-between gap-4">
                            <div className="flex items-center gap-4">
                                <div className="p-2 bg-blue-600 rounded-lg text-white">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                                </div>
                                <div>
                                    <h1 className="text-xl md:text-2xl font-bold text-gray-900 tracking-tight">å•ç®¡å…±å°„æ”¾å¤§ç”µè·¯ä»¿çœŸ</h1>
                                    <p className="text-xs text-gray-500">Virtual Electronics Lab v2.0</p>
                                </div>
                            </div>
                            <div className="flex bg-gray-100 p-1 rounded-lg">
                                <button onClick={() => setMode('friendly')} className={`px-4 py-2 text-sm font-medium rounded-md transition-all ${mode === 'friendly' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}>ğŸŒ± æ–°æ‰‹å¼•å¯¼æ¨¡å¼</button>
                                <button onClick={() => setMode('standard')} className={`px-4 py-2 text-sm font-medium rounded-md transition-all ${mode === 'standard' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}>ğŸ“ æ ‡å‡†ä»¿çœŸæ¨¡å¼</button>
                            </div>
                        </div>
                    </header>
                    
                    {/* --- Images and Principles --- */}
                    <RealLabScene />
                    <ExperimentPrinciple />
                    
                    <main className="flex-grow p-4 md:p-6 lg:p-8 max-w-7xl mx-auto w-full">
                        {mode === 'friendly' ? (
                            <FriendlyView state={state} data={data} diagnostic={diagnostic} onControlChange={handleControlChange} />
                        ) : (
                            <StandardView state={state} data={data} diagnostic={diagnostic} onControlChange={handleControlChange} />
                        )}
                    </main>

                    <footer className="bg-white border-t border-gray-200 py-6 text-center text-sm text-gray-500">
                        <p>&copy; {new Date().getFullYear()} ç”µå­å·¥ç¨‹ç³» | <span className="font-mono">å•ç®¡å…±å°„æ”¾å¤§ç”µè·¯è™šæ‹Ÿä»¿çœŸå®éªŒç³»ç»Ÿ</span></p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
